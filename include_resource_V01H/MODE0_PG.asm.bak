

;==================================================
;note:
;	JMP	PWOFF_LOOP_WAITSP
;	MR_SET_AUTOCNT1_1B ; --------------- not directly to enter sleep 

;==================================================

;=========================================
;		mode0
;=========================================

C_MODE0_0 EQU 00H ; ;HOLD
C_MODE0_1 EQU 01H ; 
C_MODE0_2 EQU 02H ;
C_MODE0_3 EQU 03H ;
C_MODE0_4 EQU 04H ;
C_MODE0_5 EQU 05H ;


;=========================================
M0_WAKEUP:

	MR_SET_DLYCNT0 CNT_STOP
;	MR_SET_DLYCNT1 CNT_STOP
	MR_SET_AUTOCNT1
	
	BRA	M0_PRE2
M0_PRE:
	
;	MR_SET_PWON_FG
.IF (C_CHK1KEY_EN1 .EQ. 1) .OR. (C_CHK1KEY_EN2 .EQ. 1)
;	JSR	BK0_CHK1KEY_HOLD
	JSR	BK0_CHK1KEY_INIT
.ENDIF
	
	MR_SET_DLYCNT0 CNT_STOP
;	MR_SET_DLYCNT1 CNT_STOP
	MR_SET_AUTOCNT1
	;MR_STOP_AUTOCNT

M0_PRE2:
	
.IF(C_CMPA_EN .EQ. 1)
.ENDIF
	MR_SET_MODE_NO C_MODE0_0
;
;--------------------------------------------
M0:

	JSR WAITKEY
	
;==========================================
M0_CHK_FLAG_A:
	LDA	USER_FLAG_A
	BIT	#C_KEYCH0_BIT
	BNE	M0S0_KEYCH0_J1
	BIT	#C_KEYCH1_BIT
	BNE	M0S0_KEYCH1_J1
	BIT	#C_KEYCH2_BIT
	BNE	M0S0_KEYCH2_J1
	BIT	#C_KEYCH3_BIT
	BNE	M0S0_KEYCH3_J1
	BIT	#C_SPCH1_BIT
	BNE	M0S0_CH1END
	BIT	#C_SPCH2_BIT
	BNE	M0S0_CH2END

	LDA	USER_FLAG_B
	BIT	#C_CNT0_BIT
	BNE	M0S0_CNT0_J1
	BIT	#C_CNT1_BIT
	BNE	M0S0_CNT1_J1
	BIT	#C_AUTO_CNT_BIT
	BNE	M0S0_AUTOCNT
	
	JMP	M0

M0S0_KEYCH0_J1:
	JMP	M0S0_KEYCH0
M0S0_KEYCH1_J1:
	JMP	M0S0_KEYCH1
M0S0_KEYCH2_J1:
	JMP	M0S0_KEYCH2
M0S0_KEYCH3_J1:
	JMP	M0S0_KEYCH3
	
	
M0S0_CNT0_J1:
	JMP	M0S0_CNT0
M0S0_CNT1_J1		
	JMP	M0S0_CNT1
		
M0S0_CH1END:
	MACRO_CLR_CH1_FLAG

	JMP	M0_CHK_FLAG_A
	
M0S0_CH2END:
	MACRO_CLR_CH2_FLAG
	
	JMP	M0_CHK_FLAG_A

M0S0_AUTOCNT_S20:

	MR_SET_AUTOCNT1
	
	JMP	M0_CHK_FLAG_A
		
M0S0_AUTOCNT:
	MACRO_CLR_AUTOCNT_FLAG

PCC_M0S0_AUTOCNT:



.IFDEF  C_CHKSKEY_EN
.IF ( C_S_KEY1_ENABLE .EQ. 1)
	LDA	R_S_KEY1_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY2_ENABLE .EQ. 1)
	LDA	R_S_KEY2_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY3_ENABLE .EQ. 1)
	LDA	R_S_KEY3_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY4_ENABLE .EQ. 1)
	LDA	R_S_KEY4_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY5_ENABLE .EQ. 1)
	LDA	R_S_KEY5_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY6_ENABLE .EQ. 1)
	LDA	R_S_KEY6_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY7_ENABLE .EQ. 1)
	LDA	R_S_KEY7_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY8_ENABLE .EQ. 1)
	LDA	R_S_KEY8_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY9_ENABLE .EQ. 1)
	LDA	R_S_KEY9_DEBOUNCE
	BNE	M0S0_AUTOCNT_S20
.ENDIF
.IF ( C_S_KEY10_ENABLE .EQ. 1)
	LDA	R_S_KEY10_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY11_ENABLE .EQ. 1)
	LDA	R_S_KEY11_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY12_ENABLE .EQ. 1)
	LDA	R_S_KEY12_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY13_ENABLE .EQ. 1)
	LDA	R_S_KEY13_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY14_ENABLE .EQ. 1)
	LDA	R_S_KEY14_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY15_ENABLE .EQ. 1)
	LDA	R_S_KEY15_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY16_ENABLE .EQ. 1)
	LDA	R_S_KEY16_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY17_ENABLE .EQ. 1)
	LDA	R_S_KEY17_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY18_ENABLE .EQ. 1)
	LDA	R_S_KEY18_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY19_ENABLE .EQ. 1)
	LDA	R_S_KEY19_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY20_ENABLE .EQ. 1)
	LDA	R_S_KEY20_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY21_ENABLE .EQ. 1)
	LDA	R_S_KEY21_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY22_ENABLE .EQ. 1)
	LDA	R_S_KEY22_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY23_ENABLE .EQ. 1)
	LDA	R_S_KEY23_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.IF ( C_S_KEY24_ENABLE .EQ. 1)
	LDA	R_S_KEY24_DEBOUNCE
	BNE	M0S0_AUTOCNT_S10
.ENDIF
.ENDIF

.IFDEF C_CHK1KEY_EN
	JSR	BK0_DET_CHK1KEY
	BNE	M0S0_AUTOCNT_S10
.ENDIF

.IFDEF C_CHKMKEY_EN
	JSR	BK0_DET_CHKMKEY
	BNE	M0S0_AUTOCNT_S10
.ENDIF

	JMP	PWOFF_LOOP_WAITSP

M0S0_AUTOCNT_S10:

	MR_SET_AUTOCNT1
	
	JMP	M0_CHK_FLAG_A
M0S0_KEYCH3:
	MACRO_CLR_KEYCH3_FLAG

	MR_SET_AUTOCNT2
	LDA	WB_KEYCH_CODE+3
	
	BRA	M0S0_KEYCH0_S20
	
M0S0_KEYCH2:
	MACRO_CLR_KEYCH2_FLAG
	
	MR_SET_AUTOCNT2
	LDA	WB_KEYCH_CODE+1
	
	BRA	M0S0_KEYCH0_S20
	
M0S0_KEYCH1:
	MACRO_CLR_KEYCH1_FLAG
	
	MR_SET_AUTOCNT2
	LDA	WB_KEYCH_CODE+1
	
	BRA	M0S0_KEYCH0_S20
	
M0S0_KEYCH0:
; key channel 0
	MACRO_CLR_KEYCH0_FLAG

	MR_SET_AUTOCNT2

	LDA	WB_KEYCH_CODE
M0S0_KEYCH0_S20:
	ASL	A
	TAX
		
	JMP	(M0S0_KEYCH0_TBL,X)
;------------------------------------------------------

M0S0_CNT0:
	MACRO_CLR_CNT0_FLAG

;	LDA	WB_DLYCNT0_IDX
;	ASL	A
;	TAX
;	JMP	(M0S0_CNT0_TBL,X)
	
M0S0_CNT0_TBL:
;	DW	M0S0_CNT0_0;POI INIT
	
	JMP	M0_CHK_FLAG_A

M0S0_CNT1:
	MACRO_CLR_CNT1_FLAG
	JMP	M0_CHK_FLAG_A
;-----------------------------------------------------

M0S0_KEYCH0_TBL:
	DW	M0S0_KEYCH0_0
	DW	M0S0_KEYCH0_1
	DW	M0S0_KEYCH0_2
	DW	M0S0_KEYCH0_3
	DW	M0S0_KEYCH0_4
	DW	M0S0_KEYCH0_5
	DW	M0S0_KEYCH0_6
	DW	M0S0_KEYCH0_7
	DW	M0S0_KEYCH0_8

	
M0S0_KEYCH0_0:
M0S0_KEYCH0_1:
M0S0_KEYCH0_2:
M0S0_KEYCH0_3:
M0S0_KEYCH0_4:
M0S0_KEYCH0_5:
M0S0_KEYCH0_6:
M0S0_KEYCH0_7:
M0S0_KEYCH0_8:

	JMP	M0_CHK_FLAG_A

;=====================================
;	SUBROUTINE,TABLE
;=======================================
T_LED_FSH1_TBL:
	DB	01111110B
	DB	01111101B
	DB	01111011B
	DB	01110111B
	DB	01101111B
	DB	01011111B
	DB	00111111B
	DB	00H

