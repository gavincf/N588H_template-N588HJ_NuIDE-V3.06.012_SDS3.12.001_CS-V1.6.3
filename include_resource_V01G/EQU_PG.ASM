
;IN: EQU_NO
;OUT: 0:EQU END,1: BUSY

BK0_PLAY_EQU_NEXT:
	INC	<EQU_NO_CNT
	BRA	BK0_PLAY_EQU_S10

BK0_PLAY_EQU:
;save
	LDA	EQU_NO
	STA	R_EQU_NO_BK

	STZ	<EQU_NO_CNT

BK0_PLAY_EQU_S10:
;
;	MR_DET_LANG_EXT;
;	BNE	BK0_PLAY_EQU_S11 ; EXT LANGUAGE

	LDA	EQU_NO
	ASL	A
	TAX
	LDA	T_EQU_TABLE,X
	STA	P0_ADDR
	
	INX
	LDA	T_EQU_TABLE,X
	STA	P0_ADDR+1
	
;	BRA	BK0_PLAY_EQU_S20
;BK0_PLAY_EQU_S11:
;
;	LDA	EQU_NO
;	ASL	A
;	TAX
;	LDA	T_EQU_EXT_TABLE,X
;	STA	P0_ADDR
;	
;	INX
;	LDA	T_EQU_EXT_TABLE,X
;	STA	P0_ADDR+1
;	
;BK0_PLAY_EQU_S20:
	
	LDA	EQU_NO_CNT
	ASL	A
	TAY
	LDA	(<P0_ADDR),Y

	CMP	#C_EQU_END
	BEQ	BK0_PLAY_EQU_END; END
	BIT	#C_BIT7
	BEQ	BK0_PLAY_EQU_S13
	MR_EVT_EQU	
	BRA	BK0_PLAY_EQU_S14
BK0_PLAY_EQU_S13:
	MR_NRL_EQU	
	
BK0_PLAY_EQU_S14:
	LDA	(<P0_ADDR),Y
	AND	#070H
	CMP	#C_EQU_SOUND
	BEQ	BK0_PLAY_EQU_SOUND
	CMP	#C_EQU_DELAY
	BEQ	BK0_PLAY_EQU_DELAY
	CMP	#C_EQU_DELAY_IDX
	BEQ	BK0_PLAY_EQU_DELAY_IDX
;equ end
	MR_SET_EQU_FG
	LDA	#0
	RTS
;-------------------- EQU END FLAG SET
BK0_PLAY_EQU_END: 
	MR_SET_EQU_DLYCNT CNT_STOP
	MR_SET_EQU_FG
	LDA	#0
	RTS
	
BK0_PLAY_EQU_SOUND:
	LDA	(<P0_ADDR),Y
	PHA ;-1
	INY
	LDA	(<P0_ADDR),Y
	STA	SOUND_NO

	JSR	BK0_PLAY_SP
	MR_SET_EQU_DLYCNT CNT_STOP
	PLA ;-1
BK0_PLAY_EQU_CONTINUE:

	JMP	BK0_PLAY_EQU_ACTION
BK0_PLAY_EQU_ACTION_RET:

BK0_PLAY_EQU_QUIT1:
	MR_SET_EQU_FG
	LDA	#1
	RTS

BK0_PLAY_EQU_DELAY:
;<1364.48MS
	LDA	(<P0_ADDR),Y
	PHA ;-1

	INY
	LDA	(<P0_ADDR),Y
	
	STA	EQU_DLYCNT
	LDA	#0FFH
	STA	EQU_DLYCNT+1
	PLA ;-1

	BRA	BK0_PLAY_EQU_CONTINUE
	
BK0_PLAY_EQU_DELAY_IDX:
;IDX

	LDA	(<P0_ADDR),Y
	PHA ;-1
	INY
	LDA	(<P0_ADDR),Y
	JMP	BK0_PLAY_EQU_DELAY_IDX_USER
BK0_PLAY_EQU_DELAY_IDX_USER_RET:
	
	PLA ;-1
	BRA	BK0_PLAY_EQU_CONTINUE
	
;================================================
; PLAY EQU WITH EQU_BUF
;================================================
L_PLAY_EQU_BUF_NEXT:
	INC EQU_IDX
L_PLAY_EQU_BUF:

	LDX	EQU_IDX
	LDA	EQU_BUF,X
	CMP	#0FFH
	BNE	L_PLAY_EQU_BUF_S10
;END

	MR_SET_EQU_FG

	LDA	#0
	RTS
	
L_PLAY_EQU_BUF_S10:
	STA	SPCH1_SOUND_NO
	
	JSR	BK0_PLAY_SP
	
	MR_SET_EQU_FG

	LDA	#1
	RTS

