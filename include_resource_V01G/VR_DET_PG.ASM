
; in TMG0
BK0_DET_VR:
	LDA	VR_STEP
	ASL	A
	TAX
	JMP	(BK0_DET_VR_TBL,X)
	
BK0_DET_VR_TBL;
	DW	BK0_DET_VR_EXIT
	DW	BK0_DET_VR_1
	DW	BK0_DET_VR_2
	DW	BK0_DET_VR_3
	DW	BK0_DET_VR_4
	DW	BK0_DET_VR_5
	DW	BK0_DET_VR_6
	DW	BK0_DET_VR_7
	DW	BK0_DET_VR_8
	DW	BK0_DET_VR_9

BK0_DET_VR_1: 
;DISCHARGE
	LDA	#1100B
	TRB	BP1D
	TRB	R_BP1
	LDA	R_BP1
	STA	BP1
	LDA	#0A0H
	STA	VR_DLYCNT
	INC	VR_STEP
	RTS
BK0_DET_VR_2:
BK0_DET_VR_4:
	INC	VR_DLYCNT
	BNE	BK0_DET_VR_EXIT2
;discharge end->start det LEFT
	LDA	#1100B
	TSB	BP1D
	LDA	R_BP1
	AND	#11110011B
	ORA	#00000100B
	STA	R_BP1
	LDA	R_BP1
	STA	BP1
	STZ	VR_DLYCNT
	INC	VR_STEP
	RTS
BK0_DET_VR_3:
;det LEFT END:
	LDA	BP1
	BIT	#0100B
	BNE	BK0_DET_VR_3_S10
	
	INC	VR_DLYCNT
BK0_DET_VR_EXIT2:
	RTS
BK0_DET_VR_3_S10:
	LDA	VR_DLYCNT
	STA	VR_LEFT_BUF ; STORE

	JMP	BK0_DET_VR_1 ;DISCHARGE 2

BK0_DET_VR_5:
;det LEFT end
	LDA	BP1
	BIT	#0100B
	BNE	BK0_DET_VR_5_S10
	
	INC	VR_DLYCNT
	RTS
BK0_DET_VR_5_S10:
	LDA	VR_DLYCNT
	STA	VR_LEFT_BUF+1 ; STORE
	
	JMP	BK0_DET_VR_1 ;DISCHARGE 3

BK0_DET_VR_6:
BK0_DET_VR_8:
	INC	VR_DLYCNT
	BNE	BK0_DET_VR_EXIT3
;discharge end->start det right
	LDA	#1100B
	TSB	BP1D
	LDA	R_BP1
	AND	#11110011B
	ORA	#00001000B
	STA	R_BP1
	LDA	R_BP1
	STA	BP1
	STZ	VR_DLYCNT
	INC	VR_STEP
BK0_DET_VR_EXIT3:
	RTS
	
BK0_DET_VR_7:
;det LEFT end
	LDA	BP1
	BIT	#1000B
	BNE	BK0_DET_VR_7_S10
	
	INC	VR_DLYCNT
	RTS
BK0_DET_VR_7_S10:
	LDA	VR_DLYCNT
	STA	VR_RIGHT_BUF ; STORE
	
	JMP	BK0_DET_VR_1 ;DISCHARGE 4

BK0_DET_VR_9:
;det LEFT end
	LDA	BP1
	BIT	#1000B
	BNE	BK0_DET_VR_9_S10
	
	INC	VR_DLYCNT
	RTS
BK0_DET_VR_9_S10:
	LDA	VR_DLYCNT
	STA	VR_RIGHT_BUF+1 ; STORE
	

;
;	VR_LEFT_BUF /	VR_RIGHT_BUF
;====================================
; user code
;====================================
;set volume
;//±ÈÀý:left/right
;left*8 / right
	CLC
	LDA	VR_RIGHT_BUF
	ADC	VR_RIGHT_BUF+1
	LSR	A
	STA	VR_RIGHT_BUF
	
	CLC
	LDA	VR_LEFT_BUF
	ADC	VR_LEFT_BUF+1
	LSR	A
	STA	VR_LEFT_BUF
;	
	CMP	VR_RIGHT_BUF
	BCC	BK0_DET_VR_S100
;LEFT>=RIGHT
	
	
	
	
	
BK0_DET_VR_S100:
;LEFT<RIGHT







;====================================
	LDA	#1
	STA	VR_STEP; LOOP	
	JMP	BK0_DET_VR_1 ;DISCHARGE 1

BK0_DET_VR_EXIT:
	RTS
