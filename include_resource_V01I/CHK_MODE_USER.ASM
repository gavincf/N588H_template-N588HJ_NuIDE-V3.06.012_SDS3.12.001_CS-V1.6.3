
;=============================
;	检测一般的模式开关;
; 每个模式对应一个INPUT IO
; N588H V01
;==================================
;
POI_MODULE_PCC_CHK_MODE EQU C_TRUE
.IF(POI_MODULE_PCC_CHK_MODE.EQ.C_FALSE)
	JSR	BK0_GET_MODE_NO
.ENDIF;POI_MODULE_PCC_CHK_MODE

WAITKEY_FXF15_PCC_CHK_MODE EQU C_TRUE
.IF(WAITKEY_FXF15_PCC_CHK_MODE.EQ.C_FALSE)
	JSR	BK0_CHK_MODE
.ENDIF;WAITKEY_FXF15_PCC_CHK_MODE



;
BK0_CHK_MODE_CHG:
	LDA	R_MODE_FG
	AND	#0F0H
	ORA	REG_EA
	STA	R_MODE_FG ;SET NEW MODE
;
;建议设置单独的标志
;set special flag
;
	MACRO_SET_KEYCH1

	JMP	BK0_CHK_MODE_CHG_RETURN


;=========================================
BK0_GET_MODE_NO:
	
;上电初始化，看到有模式就假定设定一个模式

	LDA	R_MODE_FG
	AND	#0F0H
	ORA	#C_M0_V	; essume
	STA	R_MODE_FG
;0 - (C_MAX_MODE -1 )
	
	LDA	!SR_CHKM0_PORT
	AND	#C_CHKM0_BIT
	BNE	BK0_INIT_MODE_NO_S10
	LDA	R_MODE_FG
	AND	#0F0H
	ORA	#C_M0_V	; essume
	STA	R_MODE_FG
	BRA	BK0_INIT_MODE_NO_EXIT
BK0_INIT_MODE_NO_S10:
	.IF ( C_MAX_MODE .GT. 1 )
	LDA	!SR_CHKM1_PORT
	AND	#C_CHKM1_BIT
	BNE	BK0_INIT_MODE_NO_S20
	LDA	R_MODE_FG
	AND	#0F0H
	ORA	#C_M1_V	; essume
	STA	R_MODE_FG
	BRA	BK0_INIT_MODE_NO_EXIT
BK0_INIT_MODE_NO_S20:
	.ENDIF
	.IF ( C_MAX_MODE .GT. 2 )
	LDA	!SR_CHKM2_PORT
	AND	#C_CHKM2_BIT
	BNE	BK0_INIT_MODE_NO_S30
	LDA	R_MODE_FG
	AND	#0F0H
	ORA	#C_M2_V	; essume
	STA	R_MODE_FG
	BRA	BK0_INIT_MODE_NO_EXIT
BK0_INIT_MODE_NO_S30:
	.ENDIF
	.IF ( C_MAX_MODE .GT. 3 )
	LDA	!SR_CHKM3_PORT
	AND	#C_CHKM3_BIT
	BNE	BK0_INIT_MODE_NO_S40
	LDA	R_MODE_FG
	AND	#0F0H
	ORA	#C_M3_V	; essume
	STA	R_MODE_FG
BK0_INIT_MODE_NO_S40:
	.ENDIF
	
BK0_INIT_MODE_NO_EXIT:

GET_SYS_MODE_NO:
	
	MR_DET_NORMAL_MODE
	BNE	GET_SYS_MODE_NO_S10
	
	LDA	R_MODE_FG
	AND	#0FH
	ASL	A
	ASL	A
	ASL	A
	ASL	A
	STA	REG_EA
	
	LDA	<SYS_MODE_NO
	AND	#0F0H
	ORA	REG_EA
	STA	<SYS_MODE_NO

	RTS
GET_SYS_MODE_NO_S10:
;TRYME
	LDA	#40H
	STA	<SYS_MODE_NO
	RTS

